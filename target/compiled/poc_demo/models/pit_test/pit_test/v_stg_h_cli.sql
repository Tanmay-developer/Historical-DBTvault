







-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    `cli_id`,
    `rcrd_src_nm`

    FROM ndb.raw_h_cli
),

derived_columns AS (

    SELECT

    `cli_id`,
    `rcrd_src_nm`,
    `CURRENT_TIMESTAMP` AS `ld_dt_tm`

    FROM source_data
),

hashed_columns AS (

    SELECT

    `CLI_ID`,
    `RCRD_SRC_NM`,
    `LD_DT_TM`,

    CAST(MD5(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(`cli_id` AS STRING))), ''), '^^')
    ), '^^')) AS VARCHAR(16)) AS `hk_cli_cd`

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    `CLI_ID`,
    `RCRD_SRC_NM`,
    `LD_DT_TM`,
    `HK_CLI_CD`

    FROM hashed_columns
)

SELECT * FROM columns_to_select